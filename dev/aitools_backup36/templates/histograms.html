<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>FDV POLL Histograms</title>
    <style>
      body { font-family: Segoe UI, Arial, sans-serif; margin: 24px; }
      .card { border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin-bottom: 18px; }
      .hdr { font-weight: 600; margin-bottom: 8px; }
      .outliers { font-size: 13px; color: #333; }
      .outliers a { color: #b00020; text-decoration: none; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(420px, 1fr)); gap: 16px; }
      img { max-width: 100%; height: auto; border: 1px solid #ccc; border-radius: 4px; }
      .note { color: #666; font-size: 12px; }
      .anchor { position: relative; top: -70px; visibility: hidden; }
    </style>
  </head>
  <body>
    <h2>Histograms with Outliers</h2>
    <div class="note">Outliers are detected with Tukey's IQR rule (±1.5×IQR). Click an outlier to view the raw log line.</div>
    <div class="grid">
      {% for g in groups %}
        <div class="card" id="{{ g.fdv }}">
          <div class="hdr">{{ g.fdv }} — VCC={{ g.vcc or '-' }}, TEMP={{ g.temp or '-' }}</div>
          <a href="{{ g.img_url }}" target="_blank">
            <img src="{{ g.img_url }}" alt="histogram"/>
          </a>
          {% if g.outliers %}
          <div class="outliers">
            Outliers:
            <ul>
              {% for o in g.outliers %}
                <li>
                  value={{ o.value }} — <a href="{{ o.raw_url }}" target="_blank">line {{ o.line_number }}</a>
                </li>
              {% endfor %}
            </ul>
          </div>
          {% else %}
            <div class="note">No outliers detected.</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  <p><a href="{{ url_for('results_view', token=token) }}">← Back to results</a></p>
  </body>
</html>
